@prefix rr: <http://www.w3.org/ns/r2rml#>.
@prefix ex: <http://example.com/ns#>.
@prefix map: <http://mapping.local/>.
@prefix sty: <http://purl.bioontology.org/ontology/STY/>.
@prefix sio: <http://semanticscience.org/resource/SIO_>.
@prefix foaf: <http://xmlns.com/foaf/0.1/>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix ncit: <http://ncicb.nci.nih.gov/xml/owl/EVS/Thesaurus.owl#>.
@prefix roo: <http://www.cancerdata.org/roo/>.
@prefix icd: <http://purl.bioontology.org/ontology/ICD10/>.
@prefix skos: <http://www.w3.org/2008/05/skos#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix uo: <http://purl.obolibrary.org/obo/UO_>.
@prefix time: <http://www.w3.org/2006/time#>.


map:basicQuery a rr:LogicalTable;
    rr:sqlQuery """SELECT PatientID as id,  ROUND(CAST(Age as decimal),0) as age, Gender as sex, Clinical_T_Stage as clinical_t, Clinical_N_Stage as clinical_n,
SurvivalTime as survival_time,DeadStatus as vital_status, 
(CASE WHEN (CAST(SurvivalTime as decimal)>730) THEN 1 WHEN (CAST(SurvivalTime as decimal)<=730 AND DeadStatus='1') THEN 0 ELSE NULL END) AS survival_2y 
FROM PBDWHackathon2018;""";
    rdfs:label """Every row in this table should correspond to a unique patient.<br/>
The target variables have the following name and specific meaning:
The table should contain a unique patient identifier, age, sex, t-stage, n-stage, survival time in days and vital status at this time.<br/>
<ul>
<li>id: unique identifier of the patient</li>
<li>age:  patient's age at diagnosis</li>
<li>sex:  patient's biological sex</li>
<li>clinical_t: clinical <strong>tumor</strong> stage</li>
<li>clinical_n: clinical <strong>nodal</strong> stage</li>
<li>survival_2y: two year survival </li>
</ul>""";
    skos:definition "id,age,sex,clinical_t,clinical_n,survival_2y".

map:patient a rr:TriplesMap;
    rr:logicalTable map:basicQuery; 
    rr:subjectMap [
        rr:template "patient/";
        rr:class ncit:C16960;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100022;
        rr:objectMap [
            rr:parentTriplesMap map:weightLoss3months;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100020;
        rr:objectMap [
            rr:parentTriplesMap map:neoplasm;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100024;
        rr:objectMap [
            rr:parentTriplesMap map:radiotherapy;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100278;
        rr:objectMap [
            rr:parentTriplesMap map:ctscan;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100278;
        rr:objectMap [
            rr:parentTriplesMap map:petscan;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100278;
        rr:objectMap [
            rr:parentTriplesMap map:mriscan;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100278;
        rr:objectMap [
            rr:parentTriplesMap map:ultrasound;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100024;
        rr:objectMap [
            rr:parentTriplesMap map:sentinelNodeBiopsy;
        ];
    ].

map:weightLoss3months a rr:TriplesMap;
    rr:logicalTable map:basicQuery; 
    rr:subjectMap [
        rr:template "patient/weightLoss3MonthsBeforeRt";
        rr:class ncit:C138908;
    ].

map:radiotherapy a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/radiotherapy";
            rr:class ncit:C15313;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100024;
        rr:objectMap [
            rr:parentTriplesMap map:reirradiation;
        ];
    ].

map:reirradiation a rr:TriplesMap;
    rr:logicalTable map:basicQuery; 
    rr:subjectMap [
        rr:template "patient/";
        rr:class roo:reirradiation;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100223;
        rr:objectMap [
            rr:column "reirradiationNumber"; 
            rr:datatype xsd:integer;
        ];
    ].

map:neoplasm a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/neoplasm";
            rr:class ncit:C3262;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100258;
        rr:objectMap [
            rr:parentTriplesMap map:recurrence;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100403;
        rr:objectMap [
            rr:parentTriplesMap map:tumorBoardReview;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_type;
        rr:objectMap [
            rr:parentTriplesMap map:primaryTumor;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100021;
        rr:objectMap [
            rr:parentTriplesMap map:histology;
        ];
    ].

map:recurrence a rr:TriplesMap;
    rr:logicalTable map:basicQuery; 
    rr:subjectMap [
        rr:template "patient/neoplasm/recurrence";
        rr:class ncit:C3352;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100202;
        rr:objectMap [
            rr:column "localOrRegionalRecurrence"; 
            rr:datatype xsd:string;
        ];
    ].
map:tumorBoardReview a rr:TriplesMap;
    rr:logicalTable map:basicQuery; 
    rr:subjectMap [
        rr:template "patient/neoplasm/tumorBoardReview";
        rr:class ncit:C93304;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_date;
        rr:objectMap [
            rr:column "tumorBoardReviewDate"; 
            rr:datatype xsd:date;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:decides;
        rr:objectMap [
            rr:parentTriplesMap map:treatmentRegimen;
        ];
    ].

map:treatmentRegimen a rr:TriplesMap;
    rr:logicalTable map:basicQuery; 
    rr:subjectMap [
        rr:template "patient/treatmentRegimen";
        rr:class ncit:C15697;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100448;
        rr:objectMap [
            rr:parentTriplesMap map:radiotherapy;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100448;
        rr:objectMap [
            rr:parentTriplesMap map:surgery;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100448;
        rr:objectMap [
            rr:parentTriplesMap map:chemotherapy;
        ];
    ].

map:surgery a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/treatment/surgery";
            rr:class ncit:C17173;
    ].

map:chemotherapy a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/treatment/chemotherapy";
            rr:class ncit:C15632;
    ].

map:ctscan a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/ctscan";
            rr:class ncit:C17204;
    ].

map:petscan a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/petscan";
            rr:class ncit:C17007;
    ].

map:mriscan a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/mriscan";
            rr:class ncit:C16809;
    ].

map:ultrasound a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/ultrasound";
            rr:class ncit:C17230;
    ];
    rr:predicateObjectMap [
            rr:predicate roo:local_value;
            rr:objectMap [
                rr:column "ultrasoundResults";
                rr:datatype xsd:string;
            ];
    ].

map:sentinelNodeBiopsy a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/sentinelNodeProcedure";
            rr:class ncit:C15667;
    ].

map:primaryTumor a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/neoplasm/primaryTumor";
            rr:class ncit:C8509;
        ];
    rr:predicateObjectMap [
        rr:predicate roo:P100202;
        rr:objectMap [
            rr:parentTriplesMap map:tumorSite;
        ];
    ].

map:tumorSite a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/neoplasm/tumorSite";
            rr:class sty:T029;
        ];
    rr:predicateObjectMap [
            rr:predicate roo:local_value;
            rr:objectMap [
                rr:column "tumorSite";
                rr:datatype xsd:string;
            ];
    ].

map:histology a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/neoplasm/histology";
            rr:class ncit:C19790;
        ];
    rr:predicateObjectMap [
            rr:predicate roo:local_value;
            rr:objectMap [
                rr:column "histology";
                rr:datatype xsd:string;
            ];
    ];
    rr:predicateObjectMap [
            rr:predicate roo:has_date;
            rr:objectMap [
                rr:column "histologyDate";
                rr:datatype xsd:date;
            ];
    ].       