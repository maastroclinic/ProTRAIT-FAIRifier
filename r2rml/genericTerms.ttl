@prefix rr: <http://www.w3.org/ns/r2rml#>.
@prefix ex: <http://example.com/ns#>.
@prefix map: <http://mapping.local/>.
@prefix sty: <http://purl.bioontology.org/ontology/STY/>.
@prefix sio: <http://semanticscience.org/resource/SIO_>.
@prefix foaf: <http://xmlns.com/foaf/0.1/>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix ncit: <http://ncicb.nci.nih.gov/xml/owl/EVS/Thesaurus.owl#>.
@prefix roo: <http://www.cancerdata.org/roo/>.
@prefix icd: <http://purl.bioontology.org/ontology/ICD10/>.
@prefix skos: <http://www.w3.org/2008/05/skos#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix uo: <http://purl.obolibrary.org/obo/UO_>.
@prefix time: <http://www.w3.org/2006/time#>.


map:patientQuery a rr:LogicalTable;
    rr:sqlQuery """SELECT id,
    gender,
    treating_clinic, 
    referring_clinic, 
    registration_date, 
    age_diagnosis, 
    birth_year, 
    educational_level, 
    relationship_status,
    smoking_status,
    pack_years,
    time_stopped_smoking,
    FROM patient""";
    rdfs:label """
    """;
    skos:definition "id,gender,treating_clinic,referring_clinic,registration_date,age_diagnosis,birth_year,educational_level,relationship_status".

map:patient a rr:TriplesMap;
    rr:logicalTable map:patientQuery;
    rr:subjectMap [
        rr:template "patient/{id}";
        rr:class ncit:C16960;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100061;
        rr:objectMap [
            rr:parentTriplesMap map:identifier;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
         ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100039;
        rr:objectMap [
            rr:parentTriplesMap map:treatingClinic;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:referred_by;
        rr:objectMap [
            rr:parentTriplesMap map:referringClinic;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100018;
        rr:objectMap [
            rr:parentTriplesMap map:biologicalSex;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100016;
        rr:objectMap [
            rr:parentTriplesMap map:ageAtDiagnosis;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100327;
        rr:objectMap [
            rr:parentTriplesMap map:birth;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_education_level;
        rr:objectMap [
            rr:parentTriplesMap map:educationLevel;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_relationship_status;
        rr:objectMap [
            rr:parentTriplesMap map:relationshipStatus;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100306;
        rr:objectMap [
            rr:parentTriplesMap map:smokingStatus;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100022;
        rr:objectMap [
            rr:parentTriplesMap map:alcoholUseHistory;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100249;
        rr:objectMap [
            rr:parentTriplesMap map:bodyWeight;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100255;
        rr:objectMap [
            rr:parentTriplesMap map:comorbidity;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100248;
        rr:objectMap [
            rr:parentTriplesMap map:bodyHeight;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100020;
        rr:objectMap [
            rr:parentTriplesMap map:neoplasm;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100024;
        rr:objectMap [
            rr:parentTriplesMap map:surgery;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100024;
        rr:objectMap [
            rr:parentTriplesMap map:radiotherapy;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100024;
        rr:objectMap [
            rr:parentTriplesMap map:immunotherapy;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100024;
        rr:objectMap [
            rr:parentTriplesMap map:hormoneTherapy;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100024;
        rr:objectMap [
            rr:parentTriplesMap map:chemotherapy;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100391;
        rr:objectMap [
            rr:parentTriplesMap map:registration;
        ];
    ].
    rr:predicateObjectMap [
        rr:predicate roo:P100022;
        rr:objectMap [
            rr:parentTriplesMap map:CharlsonComorbidityIndex;
        ];
    ].
    

map:biologicalSex a rr:TriplesMap;
    rr:logicalTable map:patientQuery;
        rr:subjectMap [
            rr:template "biologicalSex/{gender}";
            rr:class ncit:C28421;
    ];
    rr:predicateObjectMap [
            rr:predicate roo:P100042;
            rr:objectMap [
                rr:column "gender";
                rr:datatype xsd:string;
            ];
    ].
    
    
map:identifier a rr:TriplesMap;
    rr:logicalTable map:patientQuery;
        rr:subjectMap [
            rr:template "patient/{id}/identifier";
            rr:class ncit:C25364;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042;
        rr:objectMap [
            rr:column "id"; 
            rr:datatype xsd:string;
        ];
    ].

map:treatingClinic a rr:TriplesMap;
    rr:logicalTable map:patientQuery;
        rr:subjectMap [
            rr:template "clinic/{treating_clinic}";
            rr:class ncit:C19326;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "treatingClinic"; 
            rr:datatype xsd:string;
        ];
    ].

map:referringClinic a rr:TriplesMap;
    rr:logicalTable map:patientQuery;
        rr:subjectMap [
            rr:template "clinic/{referring_clinic}";
            rr:class ncit:C19326;
        ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042;
        rr:objectMap [
            rr:column "referringClinic"; 
            rr:datatype xsd:string;
        ];
    ].

map:registration a rr:TriplesMap;
    rr:logicalTable map:patientQuery;
        rr:subjectMap [
            rr:template "patient/{id}/registration";
            rr:class ncit:C25646;
        ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042;
        rr:objectMap [
            rr:column "registration_date"; 
            rr:datatype xsd:date;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:at_hospital;
        rr:objectMap [
            rr:parentTriplesMap map:treatingClinic;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].

map:ageAtDiagnosis a rr:TriplesMap;
    rr:logicalTable map:patientQuery;
        rr:subjectMap [
            rr:template "patient/{id}/ageAtDiagnosis";
            rr:class roo:C100002;
        ];
     rr:predicateObjectMap [
        rr:predicate roo:P100042;
        rr:objectMap [
            rr:column "age_diagnosis"; 
            rr:datatype xsd:integer;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100038;
        rr:objectMap [
            rr:parentTriplesMap map:neoplasm;
        ];
    ].   

map:birth a rr:TriplesMap;
    rr:logicalTable map:patientQuery;
        rr:subjectMap [
            rr:template "patient/{id}/birth";
            rr:class ncit:C25155;
        ];
        rr:predicateObjectMap [
            rr:predicate roo:P100027;
            rr:objectMap [
                rr:column "birth_year";
                rr:datatype xsd:gYear;
            ];
        ].
        
map:educationLevel a rr:TriplesMap;
     rr:logicalTable map:patientQuery;
     rr:subjectMap [
            rr:template "educationLevel/{education_level}";
            rr:class ncit:C17953;
        ];
        rr:predicateObjectMap [
            rr:predicate roo:local_value;
            rr:objectMap [
                rr:column "educational_level";
                rr:datatype xsd:string;
            ];
        ].
        

map:relationshipStatus a rr:TriplesMap;
    rr:logicalTable map:patientQuery;    
    rr:subjectMap [
            rr:template "relationshipStatus/{relationship_status}";
            rr:class ncit:C25188;
        ];
    rr:predicateObjectMap [
            rr:predicate roo:local_value;
            rr:objectMap [
                rr:column "relationship_status";
                rr:datatype xsd:string;
            ];
        ].

map:smokingStatus a rr:TriplesMap;
    rr:logicalTable map:patientQuery;    
    rr:subjectMap [
            rr:template "patient/{id}/smokingStatus/{smoking_status}";
            rr:class ncit:C19796;
        ];
    rr:predicateObjectMap [
        rr:predicate roo:P100306;
        rr:objectMap [
            rr:parentTriplesMap map:neverSmoker;
            ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100306;
        rr:objectMap [
            rr:parentTriplesMap map:formerSmoker;
            ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100306;
        rr:objectMap [
            rr:parentTriplesMap map:currentSmoker;
            ];
    ].

map:neverSmoker a rr:TriplesMap;
    rr:logicalTable map:patientQuery;    
    rr:subjectMap [
            rr:template "patient/{id}/smokingStatus/{smoking_status}";
            rr:class ncit:C65108;
        ].

map:formerSmoker a rr:TriplesMap;
    rr:logicalTable map:patientQuery;    
    rr:subjectMap [
            rr:template "patient/{id}/smokingStatus/{smoking_status}";
            rr:class ncit:C67148;
        ];
    rr:predicateObjectMap [
        rr:predicate roo:P100027;
        rr:objectMap [
            rr:parentTriplesMap map:packYears;
            ];
        ];
    rr:predicateObjectMap [
        rr:predicate roo:has_time;
        rr:objectMap [
            rr:parentTriplesMap map:timeStoppedSmoking;
        ];
    ].

map:currentSmoker a rr:TriplesMap;
    rr:logicalTable map:patientQuery;    
    rr:subjectMap [
            rr:template "patient/{id}/smokingStatus/{smoking_status}";
            rr:class ncit:C67147;
        ];
    rr:predicateObjectMap [
        rr:predicate roo:P100027;
        rr:objectMap [
            rr:parentTriplesMap map:packYears;
            ];
    ].

map:packYears a rr:TriplesMap;
    rr:logicalTable map:patientQuery;    
    rr:subjectMap [
            rr:template "patient/{id}/smokingStatus/packYears/{pack_years}";
            rr:class ncit:C73993;
        ].

map:timeStoppedSmoking a rr:TriplesMap;
    rr:logicalTable map:patientQuery;    
    rr:subjectMap [
            rr:template "patient/{id}/smokingStatus/formerSmoker/timeStoppedSmoking";
            rr:class ncit:timeStoppedSmoking;
        ];
    rr:predicateObjectMap [
        rr:predicate roo:P100027;
        rr:objectMap [
            rr:parentTriplesMap map:Month;
            ];
    ].

map:Month a rr:TriplesMap;
    rr:logicalTable map:patientQuery;    
    rr:subjectMap [
            rr:template "patient/{id}/smokingStatus/formerSmoker/timeStoppedSmoking/months";
            rr:class uo:0000035;
        ];
    rr:predicateObjectMap [
            rr:predicate roo:local_value;
            rr:objectMap [
                rr:column "time_stopped_smoking";
                rr:datatype xsd:string;
            ];
        ].

map:alcoholUseHistory a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/personalHistory/alcoholUseHistory/{alcoholUseHistory}";
            rr:class ncit:C81229;
    ];
    rr:predicateObjectMap [
            rr:predicate roo:local_value;
            rr:objectMap [
                rr:column "alcoholUseHistory";
                rr:datatype xsd:string;
            ];
    ].
    

map:bodyWeight a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/bodyWeight";
            rr:class ncit:C81328;
        ];
    rr:predicateObjectMap [
        rr:predicate roo:P100027;
        rr:objectMap [
            rr:parentTriplesMap map:kilogram;
            ];       
    ].

map:kilogram a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/bodyWeight/kilogram";
            rr:class uo:0000009;
        ].   

map:bodyHeight a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/bodyHeight";
            rr:class ncit:C94488;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100027;
        rr:objectMap [
            rr:parentTriplesMap map:centimeter;
            ];       
    ].

map:centimeter a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/bodyHeight/centimeter";
            rr:class uo:0000015;
        ].   

map:comorbidity a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/comorbidityIndex";
            rr:class ncit:C2991;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "comorbidity"; 
            rr:datatype xsd:string;
        ];
    ].

map:CharlsonComorbidityIndex a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/comorbidit/CharlsonComorbidityIndex";
            rr:class ncit:CharlsonComorbidityIndex;
        ].
    
map:neoplasm a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/neoplasm";
            rr:class ncit:C3262;
        ];
    rr:predicateObjectMap [
        rr:predicate roo:P100251;
        rr:objectMap [
            rr:parentTriplesMap map:dateOfDiagnosis;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "tumorType"; 
            rr:datatype xsd:string;
        ];
    ].

map:dateOfDiagnosis a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/diagnosis/dateOfDiagnosis/{dateOfDiagnosis}";
            rr:class ncit:C25164;
        ].

map:surgery a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/treatment/surgery";
            rr:class ncit:C17173;
        ];
    rr:predicateObjectMap [
        rr:predicate roo:P100402;
        rr:objectMap [
            rr:parentTriplesMap map:neoplasm;
        ];
    ].

map:radiotherapy a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/treatment/radiotherapy";
            rr:class ncit:C15313;
        ];
    rr:predicateObjectMap [
        rr:predicate roo:P100402;
        rr:objectMap [
            rr:parentTriplesMap map:neoplasm;
        ];
    ];    
    rr:predicateObjectMap [
        rr:predicate roo:has_type;
        rr:objectMap [
            rr:parentTriplesMap map:protonTherapy;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_type;
        rr:objectMap [
            rr:parentTriplesMap map:photonTherapy;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_planning_comparison;
        rr:objectMap [
            rr:parentTriplesMap map:planningComparison;
        ];
    ].

map:protonTherapy a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/treatment/radiotherapy/protonTherapy";
            rr:class ncit:C66897;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_reason;
            rr:objectMap [
                rr:column "reasonForNoProtonTherapy";
                rr:datatype xsd:string;
            ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_created;
        rr:objectMap [
            rr:parentTriplesMap map:registration;
        ];
    ].

map:photonTherapy a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/treatment/radiotherapy/photonTherapy";
            rr:class ncit:C104914;
    ].
	
map:chemotherapy a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/treatment/chemotherapy";
            rr:class ncit:C15632;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100402;
        rr:objectMap [
            rr:parentTriplesMap map:neoplasm;
        ];
    ].

map:immunotherapy a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/treatment/immunotherapy";
            rr:class ncit:C15262;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100402;
        rr:objectMap [
            rr:parentTriplesMap map:neoplasm;
        ];
    ].
map:hormoneTherapy a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/treatment/hormoneTherapy";
            rr:class ncit:C15445;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100402;
        rr:objectMap [
            rr:parentTriplesMap map:neoplasm;
        ];
    ].

map:planningComparison a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
            rr:template "patient/treatment/radiotherapy/planningComparison";
            rr:class roo:planningComparison;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_date;
        rr:objectMap [
            rr:column "PlanningComparisonDate"; 
            rr:datatype xsd:date;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100267;
        rr:objectMap [
            rr:column "PlanningComparisonVersion"; 
            rr:datatype xsd:float;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042;
        rr:objectMap [
            rr:column "PlanningComparisonYesNo"; 
            rr:datatype xsd:boolean;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_reason;
        rr:objectMap [
            rr:column "PlanningComparisonYesNo"; 
            rr:datatype skos:note;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100397;
        rr:objectMap [
            rr:parentTriplesMap map:protonTherapy;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100397;
        rr:objectMap [
            rr:parentTriplesMap map:photonTherapy;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_registration;
        rr:objectMap [
            rr:parentTriplesMap map:registration;
        ];
    ].
