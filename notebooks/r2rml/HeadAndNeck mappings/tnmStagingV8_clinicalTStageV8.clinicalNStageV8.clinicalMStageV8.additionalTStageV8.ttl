
########################################## same ontologies as v7!
# Add TNM staging V8                                         
########################################## 
map:tnmstagingV8Query a rr:LogicalTable;
    rr:sqlQuery """SELECT 
    GEN_IDNUMBER as id, 
    HN_TSTAGE_8 as clinicalTStageV8,
    HN_NSTAGE_8 as clinicalNStageV8,
    HN_MSTAGE_8 as clinicalMStageV8,
    HN_TSTAGE_8_ADD as additionalTStageV8
        FROM PBDWHackathon2018;""";
    rdfs:label "";
    skos:definition "".

map:tnmStagingV8 a rr:TriplesMap;
    rr:logicalTable map:tnmstagingV8Query;    
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/tnmStaging/tnmStagingV8";
        rr:class ncit:C38027; #stage grouping (TNM stage grouping)
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100244; #has_clinical_T_stage             
        rr:objectMap [
            rr:parentTriplesMap map:clinicalTStageV8;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100242; #has_clinical_N_stage           
        rr:objectMap [
            rr:parentTriplesMap map:clinicalNStageV8;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100241; #has_clinical_M_stage 
        rr:objectMap [
            rr:parentTriplesMap map:clinicalMStageV8;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_additional_T_stage; #new roo predicate 
        rr:objectMap [
            rr:parentTriplesMap map:additionalTStageV8;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].

map:clinicalTStageV8 a rr:TriplesMap;
    rr:logicalTable map:tnmstagingV8Query; 
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/tnmStaging/tnmStagingV8/clinicalTStageV8/{clinicalTStageV8}";
        rr:class roo:clinicalTStage; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "clinicalTStageV8"; 
            rr:datatype xsd:string;
        ];
    ].

map:clinicalNStageV8 a rr:TriplesMap;
    rr:logicalTable map:tnmstagingV8Query; 
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/tnmStaging/tnmStagingV8/clinicalNStageV8/{clinicalNStageV8}";
        rr:class roo:clinicalNStage; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "clinicalNStageV8"; 
            rr:datatype xsd:string;
        ];
    ].
 
map:clinicalMStageV8 a rr:TriplesMap;
    rr:logicalTable map:tnmstagingV8Query; 
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/tnmStaging/tnmStagingV8/clinicalMStageV8/{clinicalMStageV8}";
        rr:class roo:clinicalMStage; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "clinicalMStageV8"; 
            rr:datatype xsd:string;
        ];
    ].
 
map:additionalTStageV8 a rr:TriplesMap;
    rr:logicalTable map:tnmstagingV8Query; 
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/tnmStaging/tnmStagingV8/additionalTStageV8/{additionalTStageV8}";
        rr:class roo:additionalTStage; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "additionalTStageV8"; 
            rr:datatype xsd:string;
        ];
    ].
    
map:tnmStaging rr:predicateObjectMap [
        rr:predicate roo:has_tnm_staging; #new roo predicate                                                          
        rr:objectMap [
            rr:parentTriplesMap map:tnmStagingV8;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].