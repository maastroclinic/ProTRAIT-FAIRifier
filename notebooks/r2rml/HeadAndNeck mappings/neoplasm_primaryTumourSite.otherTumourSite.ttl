
##########################################
# Add neoplasm                                    #weird excel construction, does this work same ontology?               
########################################## 
map:neoplasmQuery a rr:LogicalTable;
    rr:sqlQuery """SELECT 
    GEN_IDNUMBER as id, 
    HN_TUMOUR_SITE as primaryTumourSite,
    HN_TUMOUR_SITE_OTH as otherTumourSite
        FROM PBDWHackathon2018;""";
    rdfs:label "";
    skos:definition "".
    
map:neoplasm a rr:TriplesMap;
    rr:logicalTable map:basicQuery;    
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm";
        rr:class ncit:C3262; #neoplasm
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_type; #new roo predicate
        rr:objectMap [
            rr:parentTriplesMap map:primaryTumour;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].

map:primaryTumourSite a rr:TriplesMap;
    rr:logicalTable map:neoplasmQuery;    
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/primaryTumourSite/{primaryTumourSite}";
        rr:class roo:primaryNeoplasmSite; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "primaryTumourSite";
            rr:datatype xsd:string;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_type; #new roo predicate
        rr:objectMap [
            rr:parentTriplesMap map:otherTumourSite;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].

map:otherTumourSite a rr:TriplesMap;
    rr:logicalTable map:neoplasmQuery;    
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/primaryTumourSite/otherTumourSite/{otherTumourSite}";
        rr:class roo:primaryNeoplasmSite; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "otherTumourType"; 
            rr:datatype xsd:string;
        ];
    ].

map:patient rr:predicateObjectMap [
        rr:predicate roo:has_neoplasm; #new roo predicate
        rr:objectMap [
            rr:parentTriplesMap map:neoplasm;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].
