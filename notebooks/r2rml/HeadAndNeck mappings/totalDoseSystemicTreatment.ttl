
########################################## 
# Add total dose systemic treatment                                       
########################################## 
map:systemicTreatmentQuery a rr:LogicalTable;
    rr:sqlQuery """SELECT 
    GEN_IDNUMBER as id, 
    HN_SYST_TR_DOSE_CIS_WE as totalDoseCisplatinWeekly,
    HN_SYST_TR_DOSE_CIS_3WE as totalDoseCisplatin3Weekly,
    HN_SYST_TR_DOSE_CET as totalDoseCetuximab,
    HN_SYST_TR_DOSE_TPF as totalDoseTPF,
    HN_SYST_TR_DOSE_5FU as totalDose5FUAndC,
    HN_SYST_TR_DOSE_OTH as totalDoseOther
        FROM PBDWHackathon2018;""";
    rdfs:label "";
    skos:definition "".

map:totalDoseSystemicTreatment a rr:TriplesMap;
    rr:logicalTable map:totalDoseSystemicTreatmentQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/systemicTreatment/totalDoseSystemicTreatment";
        rr:class ncit:C94394; #cumulative dose                                             
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100423; #consists_of
        rr:objectMap [
            rr:parentTriplesMap map:totalDoseCisplatinWeekly;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ]; 
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100423; #consists_of
        rr:objectMap [
            rr:parentTriplesMap map:totalDoseCisplatin3Weekly;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ]; 
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100423; #consists_of
        rr:objectMap [
            rr:parentTriplesMap map:totalDoseCetuximab;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ]; 
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100423; #consists_of
        rr:objectMap [
            rr:parentTriplesMap map:totalDoseTPF;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ]; 
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100423; #consists_of
        rr:objectMap [
            rr:parentTriplesMap map:totalDose5FUAndC;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ]; 
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100423; #consists_of
        rr:objectMap [
            rr:parentTriplesMap map:totalDoseOther;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ]; 
        ];
    ].

map:totalDoseCisplatinWeekly a rr:TriplesMap;
    rr:logicalTable map:totalDoseSystemicTreatmentQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/systemicTreatment/totalDoseSystemicTreatment/totalDoseCisplatinWeekly/{totalDoseCisplatinWeekly}";
        rr:class roo:totalDoseCisplatinWeekly; #new roo class                                       
    ];
     rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "totalDoseCisplatinWeekly"; 
            rr:datatype xsd:float; 
        ];
    ].

map:totalDoseCisplatin3Weekly a rr:TriplesMap;
    rr:logicalTable map:totalDoseSystemicTreatmentQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/systemicTreatment/totalDoseSystemicTreatment/totalDoseCisplatin3Weekly/{totalDoseCisplatin3Weekly}";
        rr:class roo:totalDoseCisplatin3Weekly; #new roo class                                       
    ];
     rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "totalDoseCisplatin3Weekly"; 
            rr:datatype xsd:float; 
        ];
    ].

map:totalDoseCetuximab a rr:TriplesMap;
    rr:logicalTable map:totalDoseSystemicTreatmentQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/systemicTreatment/totalDoseSystemicTreatment/totalDoseCetuximab/{totalDoseCetuximab}";
        rr:class roo:totalDoseCetuximab; #new roo class                                       
    ];
     rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "totalDoseCetuximab"; 
            rr:datatype xsd:float; 
        ];
    ].

map:totalDoseTPF a rr:TriplesMap;
    rr:logicalTable map:totalDoseSystemicTreatmentQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/systemicTreatment/totalDoseSystemicTreatment/totalDoseTPF/{totalDoseTPF}";
        rr:class roo:totalDoseTPF; #new roo class                                       
    ];
     rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "totalDoseTPF"; 
            rr:datatype xsd:float; 
        ];
    ].

map:totalDose5FUAndC a rr:TriplesMap;
    rr:logicalTable map:totalDoseSystemicTreatmentQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/systemicTreatment/totalDoseSystemicTreatment/totalDose5FUAndC/{totalDose5FUAndC}";
        rr:class roo:totalDose5FUAndC; #new roo class                                       
    ];
     rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "totalDose5FUAndC"; 
            rr:datatype xsd:float; 
        ];
    ].

map:totalDoseOther a rr:TriplesMap;
    rr:logicalTable map:totalDoseSystemicTreatmentQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/systemicTreatment/totalDoseSystemicTreatment/totalDoseOther/{totalDoseOther}";
        rr:class roo:totalDoseOther; #new roo class                                       
    ];
     rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "totalDoseOther"; 
            rr:datatype xsd:float; 
        ];
    ].
    
map:systemicTreatment rr:predicateObjectMap [
        rr:predicate roo:has_total_dose_systemic_treatment; #new roo predicate
        rr:objectMap [
            rr:parentTriplesMap map:totalDoseSystemicTreatment;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].