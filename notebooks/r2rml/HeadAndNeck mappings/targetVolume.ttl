
########################################## 
# Add target volume                             CTV1&2, problems with the same ctv? cc correct iri?
########################################## 
map:targetVolumeQuery a rr:LogicalTable;
    rr:sqlQuery """SELECT 
    GEN_IDNUMBER as id, 
    HN_PREP_PLAN_TARVOL as targetVolume,
    HN_PREP_PLAN_GTV as grossTargetVolume,
    HN_PREP_PLAN_CTV1 as cTV1,
    HN_PREP_PLAN_CTV2 as cTV2
        FROM PBDWHackathon2018;""";
    rdfs:label "";
    skos:definition "".

map:targetVolume a rr:TriplesMap;
    rr:logicalTable map:targetVolumeQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy/targetVolume/{targetVolume}";
        rr:class roo:targetVolume; #new roo classification
    ];
     rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "targetVolume"; 
            rr:datatype xsd:string; 
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100212; #has_property
        rr:objectMap [
            rr:parentTriplesMap map:grossTargetVolume; 
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100212; #has_property
        rr:objectMap [
            rr:parentTriplesMap map:cTV1; 
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100212; #has_property
        rr:objectMap [
            rr:parentTriplesMap map:cTV2; 
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].

map:grossTargetVolume a rr:TriplesMap;
    rr:logicalTable map:targetVolumeQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy/targetVolume/grossTargetVolume/{grossTargetVolume}";
        rr:class ncit:C112913; #gross target volume
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100027; #has_unit
        rr:objectMap [
            rr:parentTriplesMap map:cubicCentimeter; 
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "grossTargetVolume"; 
            rr:datatype xsd:integer; 
        ];
    ].

map:cTV1 a rr:TriplesMap;
    rr:logicalTable map:targetVolumeQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy/targetVolume//cTV1{cTV1}";
        rr:class ncit:C112912; #clinical target volume  
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100027; #has_unit
        rr:objectMap [
            rr:parentTriplesMap map:cubicCentimeter;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ]; 
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "cTV1"; 
            rr:datatype xsd:integer; 
        ];
    ].

map:cTV2 a rr:TriplesMap;
    rr:logicalTable map:targetVolumeQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy/targetVolume/cTV2/{cTV2}";
        rr:class ncit:C112912; #clinical target volume
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100027; #has_unit
        rr:objectMap [
            rr:parentTriplesMap map:cubicCentimeter;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ]; 
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "cTV2"; 
            rr:datatype xsd:integer;          
        ];
    ].

map:cubicCentimeter a rr:TriplesMap;
    rr:logicalTable map:targetVolumeQuery;
    rr:subjectMap [
        rr:template "cubicCentimeter";
        rr:class uo:0000097; #cubic centimeter         
    ].

map:radiotherapy rr:predicateObjectMap [
        rr:predicate roo:P100212; #has_property
        rr:objectMap [
            rr:parentTriplesMap map:targetVolume; 
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].