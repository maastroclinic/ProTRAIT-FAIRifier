
########################################## 
# Add cancer treatment                                       
########################################## 
map:cancerTreatmentQuery a rr:LogicalTable;
    rr:sqlQuery """SELECT 
    GEN_IDNUMBER as id, 
    HN_TREATM_LOC_RECUR as localRecurrenceTreatment,
    HN_TREATM_REG_RECUR as regionalRecurrenceTreatment,
    HN_PT_CLIN_TRIAL as partOfClinicalTrial
        FROM PBDWHackathon2018;""";
    rdfs:label "";
    skos:definition "".

map:cancerTreatment a rr:TriplesMap;
    rr:logicalTable map:cancerTreatmentQuery;    
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/";
        rr:class ncit:C16212; #cancer therapeutic procedure
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100423; #consists_of
        rr:objectMap [
            rr:parentTriplesMap map:baselineTreatment;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ]; 
        ];
    ].

map:baselineTreatment a rr:TriplesMap;
    rr:logicalTable map:cancerTreatmentQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/baselineTreatment/";
        rr:class roo:baselineTreatment; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100423; #consists_of
        rr:objectMap [
            rr:parentTriplesMap map:localRecurrenceTreatment;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100423; #consists_of
        rr:objectMap [
            rr:parentTriplesMap map:regionalRecurrenceTreatment;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100423; #consists_of
        rr:objectMap [
            rr:parentTriplesMap map:partOfClinicalTrial;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].

map:localRecurrenceTreatment a rr:TriplesMap;
    rr:logicalTable map:cancerTreatmentQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/baselineTreatment/localRecurrenceTreatment/{localRecurrenceTreatment}";
        rr:class roo:localRecurrenceTreatment; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value                                                  
        rr:objectMap [
            rr:column "localRecurrenceTreatment"; 
            rr:datatype xsd:boulean; 
        ];
    ].
    
map:regionalRecurrenceTreatment a rr:TriplesMap;
    rr:logicalTable map:cancerTreatmentQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/baselineTreatment/regionalRecurrenceTreatment/{regionalRecurrenceTreatment}";
        rr:class roo:regionalRecurrenceTreatment; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value                                                  
        rr:objectMap [
            rr:column "regionalRecurrenceTreatment"; 
            rr:datatype xsd:boulean; 
        ];
    ].

map:partOfClinicalTrial a rr:TriplesMap;
    rr:logicalTable map:cancerTreatmentQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/baselineTreatment/partOfClinicalTrial/{partOfClinicalTrial}";
        rr:class roo:partOfClinicalTrial; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value                                                  
        rr:objectMap [
            rr:column "partOfClinicalTrial"; 
            rr:datatype xsd:boulean; 
        ];
    ].

map:patient rr:predicateObjectMap [
        rr:predicate roo:has_cancer_treatment; #new roo predicate
        rr:objectMap [
            rr:parentTriplesMap map:cancerTreatment;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].