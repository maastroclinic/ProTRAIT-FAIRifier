
########################################## 
# Add radiotherapy related factors         weird imaging structure?                    
########################################## 
map:radiotherapyRelatedFactorsQuery a rr:LogicalTable;
    rr:sqlQuery """SELECT 
    GEN_IDNUMBER as id, 
    HN_RT_REPAINT as layerRepaintingType,
    HN_RT_REPAINT_NR as layerRepaintingNumber,
    HN_RT_BEAM_ABSORB as typeOfBeamAbsorber,
    HN_RT_NR_ISOC as numberOfIsocentres,
    HN_RT_POS_COR as positionCorrection,
    HN_RT_IMAGING as typeOfImaging,
    HN_RT_IMAGING_OTHER as typeOfImaging
        FROM PBDWHackathon2018;""";
    rdfs:label "";
    skos:definition "".

map:radiotherapyRelatedFactors a rr:TriplesMap;
    rr:logicalTable map:radiotherapyRelatedFactorsQuery;    
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy/radiotherapyRelatedFactors";
        rr:class roo:radiotherapyRelatedFactors; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100212; #has_property                                         
        rr:objectMap [
            rr:parentTriplesMap map:layerRepaintingType;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100212; #has_property                                         
        rr:objectMap [
            rr:parentTriplesMap map:layerRepaintingNumber;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100212; #has_property                                         
        rr:objectMap [
           rr:parentTriplesMap map:typeOfBeamAbsorber;
           rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100212; #has_property                                         
        rr:objectMap [
           rr:parentTriplesMap map:numberOfIsocentres;
           rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100212; #has_property                                         
        rr:objectMap [
           rr:parentTriplesMap map:positionCorrection;
           rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100212; #has_property                                         
        rr:objectMap [
           rr:parentTriplesMap map:typeOfImaging;
           rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100212; #has_property                                         
        rr:objectMap [
           rr:parentTriplesMap map:otherTypeOfImaging;
           rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].
     

map:layerRepaintingType a rr:TriplesMap;
    rr:logicalTable map:radiotherapyRelatedFactorsQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy/radiotherapyRelatedFactors/layerRepaintingType/{layerRepaintingType}";
        rr:class roo:layerRepaintingType; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value                                       
        rr:objectMap [
            rr:column "layerRepaintingType"; 
            rr:datatype xsd:string;
        ];
    ].

map:layerRepaintingNumber a rr:TriplesMap;
    rr:logicalTable map:radiotherapyRelatedFactorsQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy/radiotherapyRelatedFactors/layerRepaintingNumber/{layerRepaintingNumber}";
        rr:class roo:layerRepaintingNumber; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value                                       
        rr:objectMap [
            rr:column "layerRepaintingNumber"; 
            rr:datatype xsd:float;
        ];
    ].

map:typeOfBeamAbsorber a rr:TriplesMap;
    rr:logicalTable map:radiotherapyRelatedFactorsQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy/radiotherapyRelatedFactors/typeOfBeamAbsorber/{typeOfBeamAbsorber}";
        rr:class ncit:C50372; #absorber device
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "typeOfBeamAbsorber"; 
            rr:datatype xsd:string; 
        ];       
    ].

map:numberOfIsocentres a rr:TriplesMap;
    rr:logicalTable map:radiotherapyRelatedFactorsQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy/radiotherapyRelatedFactors/numberOfIsocentres/{numberOfIsocentres}";
        rr:class roo:numberOfIsocentres; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value                                       
        rr:objectMap [
            rr:column "numberOfIsocentres"; 
            rr:datatype xsd:float;
        ];
    ].

map:positionCorrection a rr:TriplesMap;
    rr:logicalTable map:radiotherapyRelatedFactorsQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy/radiotherapyRelatedFactors/positionCorrection/{positionCorrection}";
        rr:class roo:positionCorrection; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "positionCorrection"; 
            rr:datatype xsd:string; 
        ];       
    ].

map:typeOfImaging a rr:TriplesMap;
    rr:logicalTable map:radiotherapyRelatedFactorsQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy/radiotherapyRelatedFactors/typeOfImaging/{typeOfImaging}";
        rr:class roo:typeOfImaging; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "typeOfImaging"; 
            rr:datatype xsd:string; 
        ];       
    ].

map:otherTypeOfImaging a rr:TriplesMap;
    rr:logicalTable map:radiotherapyRelatedFactorsQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy/radiotherapyRelatedFactors/otherTypeOfImaging/{otherTypeOfImaging}";
        rr:class roo:otherTypeOfImaging; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "otherTypeOfImaging"; 
            rr:datatype xsd:string; 
        ];       
    ].

map:radiotherapy rr:predicateObjectMap [
        rr:predicate roo:has_radiotherapy_related_factors; #new roo predicate 
        rr:objectMap [
            rr:parentTriplesMap map:radiotherapyRelatedFactors;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].   