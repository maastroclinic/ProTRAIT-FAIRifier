
##########################################
# Add histology                                                   
########################################## 
map:histologyQuery a rr:LogicalTable;
    rr:sqlQuery """SELECT 
    GEN_IDNUMBER as id, 
    HN_HISTO as histologyReport,
    HN_HISTO_DATE as histologyDate
        FROM PBDWHackathon2018;""";
    rdfs:label "";
    skos:definition "".

map:histology a rr:TriplesMap;
    rr:logicalTable map:histologyQuery;    
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/histology"; 
        rr:class ncit:C16681 #histology
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_report; #new roo class
        rr:objectMap [
            rr:parentTriplesMap map:histologyReport;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100228; #has_date
        rr:objectMap [
            rr:parentTriplesMap map:histologyDate;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].

map:histologyReport a rr:TriplesMap;
    rr:logicalTable map:histologyQuery;    
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/histology/histologyReport/{histologyReport]";
        rr:class ncit:C28277; #Pathology Report
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "histologyReport";
            rr:datatype xsd:string;
        ];
    ].

map:histologyDate a rr:TriplesMap;
    rr:logicalTable map:histologyQuery;    
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/histology/histologyDate/{histologyDate}";
        rr:class roo:histologyDate; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "histologyDate";
            rr:datatype xsd:date;
        ];
    ].

map:neoplasm rr:predicateObjectMap [
        rr:predicate roo:P100021; #has_histology
        rr:objectMap [
            rr:parentTriplesMap map:histology;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].