
########################################## same ontologies as v7!
# Add TNM staging pathological                                         
########################################## 
map:pathologicalTNMStagingQuery a rr:LogicalTable;
    rr:sqlQuery """SELECT 
    GEN_IDNUMBER as id, 
    HN_SURG_PTSTAGE as pathologicalTStage,
    HN_SURG_NECK_NSTAGE as pathologicalNStage
        FROM PBDWHackathon2018;""";
    rdfs:label "";
    skos:definition "".

map:pathologicalTNMStaging a rr:TriplesMap;
    rr:logicalTable map:PathologicalTNMStagingQuery;    
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/tnmStaging/pathologicalTNMStaging";
        rr:class ncit:C38027; #stage grouping (TNM stage grouping)
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100288; #has_pathological_T_stage
        rr:objectMap [
            rr:parentTriplesMap map:pathologicalTStage;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ]; 
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100286; #has_pathological_n_stage
        rr:objectMap [
            rr:parentTriplesMap map:pathologicalNStage;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ]; 
        ];
    ].

map:pathologicalTStage a rr:TriplesMap;
    rr:logicalTable map:PathologicalTNMStagingQuery;
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/tnmStaging/pathologicalTNMStaging/pathologicalTStage/{pathologicalTStage}";
        rr:class ncit:C25728; #T Category (T Stage)
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;  
        rr:objectMap [
            rr:column "pathologicalTStage"; 
            rr:datatype xsd:string; 
        ];
    ].

map:pathologicalNStage a rr:TriplesMap;
    rr:logicalTable map:PathologicalTNMStagingQuery;
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/tnmStaging/pathologicalTNMStaging/pathologicalNStage/{pathologicalNStage}";
        rr:class ncit:C25580; #N Category (N Stage)
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;                                                       
        rr:objectMap [
            rr:column "pathologicalNStage"; 
            rr:datatype xsd:string; 
        ];
    ].
    
map:tnmStaging rr:predicateObjectMap [
        rr:predicate roo:has_tnm_staging; #new roo predicate                                                          
        rr:objectMap [
            rr:parentTriplesMap map:pathologicalTNMStaging;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].