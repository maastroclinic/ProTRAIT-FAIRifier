
########################################## 
# Add radiotherapy                             
########################################## 
map:radiotherapyQuery a rr:LogicalTable;
    rr:sqlQuery """SELECT 
    GEN_IDNUMBER as id, 
    HN_REIRR as reirradiation,
    HN_RT_PLAN_ADAPT as planAdaptation,
    HN_RT_ART as imageGuidedAdaptiveRadiationTherapy
        FROM PBDWHackathon2018;""";
    rdfs:label "";
    skos:definition "".

map:radiotherapy a rr:TriplesMap;
    rr:logicalTable map:radiotherapyQuery;    
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy";
        rr:class ncit:C15313; #radiation therapy
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_subtype; #new roo predicate  
        rr:objectMap [
            rr:parentTriplesMap map:reirradiation;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100082; #has occurence                                        
        rr:objectMap [
            rr:parentTriplesMap map:planAdaptation;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_treatment_technique; #new roo predicate 
        rr:objectMap [
            rr:parentTriplesMap map:imageGuidedAdaptiveRadiationTherapy;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].

map:reirradiation a rr:TriplesMap;
    rr:logicalTable map:radiotherapyQuery; 
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy/reirradiation/{reirradiation}";
        rr:class roo:reirradiation; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100223; #has_count
        rr:objectMap [
            rr:column "reirradiation"; 
            rr:datatype xsd:integer;
        ];
    ].

map:planAdaptation a rr:TriplesMap;
    rr:logicalTable map:radiotherapyQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy/planAdaptation/{planAdaptation}";
        rr:class roo:planAdaptation; #new roo class 
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value                                       
        rr:objectMap [
            rr:column "planAdaptation"; 
            rr:datatype xsd:boulean; 
        ];
    ].

map:imageGuidedAdaptiveRadiationTherapy a rr:TriplesMap;
    rr:logicalTable map:radiotherapyQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment//radiotherapy/imageGuidedAdaptiveRadiationTherapy/{imageGuidedAdaptiveRadiationTherapy}";
        rr:class ncit:C116432; #image guided adaptive radiation therapy                    
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;                                         
        rr:objectMap [
            rr:column "imageGuidedAdaptiveRadiationTherapy"; 
            rr:datatype xsd:string; 
        ];
    ].

map:cancerTreatment rr:predicateObjectMap [
        rr:predicate roo:P100024; #has_procedure
        rr:objectMap [
            rr:parentTriplesMap map:radiotherapy;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].   