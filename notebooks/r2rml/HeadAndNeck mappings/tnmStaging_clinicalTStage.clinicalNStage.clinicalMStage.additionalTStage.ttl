
##########################################
# Add TNM staging                                          
########################################## 
map:tnmstagingQuery a rr:LogicalTable;
    rr:sqlQuery """SELECT 
    GEN_IDNUMBER as id, 
    HN_TSTAGE_7 as clinicalTStage,
    HN_NSTAGE_7 as clinicalNStage,
    HN_MSTAGE_7 as clinicalMStage,
    HN_TSTAGE_7_ADD as additionalTStage
        FROM PBDWHackathon2018;""";
    rdfs:label "";
    skos:definition "".

map:tnmStaging a rr:TriplesMap;
    rr:logicalTable map:tnmstagingQuery;    
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/TNMStaging";
        rr:class ncit:C38027; #stage grouping (TNM stage grouping)
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100244; #has_clinical_T_stage             
        rr:objectMap [
            rr:parentTriplesMap map:clinicalTStage;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100242; #has_clinical_N_stage           
        rr:objectMap [
            rr:parentTriplesMap map:clinicalNStage;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100241; #has_clinical_M_stage 
        rr:objectMap [
            rr:parentTriplesMap map:clinicalMStage;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:has_additional_T_stage; #new roo predicate 
        rr:objectMap [
            rr:parentTriplesMap map:additionalTStage;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].

map:clinicalTStage a rr:TriplesMap;
    rr:logicalTable map:tnmstagingQuery; 
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/TNMStaging/clinicalTStage/{clinicalTStage}";
        rr:class roo:clinicalTStage; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "clinicalTStage"; 
            rr:datatype xsd:string;
        ];
    ].

map:clinicalNStage a rr:TriplesMap;
    rr:logicalTable map:tnmstagingQuery; 
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/TNMStaging/clinicalNStage/{clinicalNStage}";
        rr:class roo:clinicalNStage; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "clinicalNStage"; 
            rr:datatype xsd:string;
        ];
    ].
 
map:clinicalMStage a rr:TriplesMap;
    rr:logicalTable map:tnmstagingQuery; 
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/TNMStaging/clinicalMStage/{clinicalMStage}";
        rr:class roo:clinicalMStage; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "clinicalMStage"; 
            rr:datatype xsd:string;
        ];
    ].
 
map:additionalTStage a rr:TriplesMap;
    rr:logicalTable map:tnmstagingQuery; 
    rr:subjectMap [
        rr:template "patient/{id}/neoplasm/TNMStaging/additionalTStage/{additionalTStage}";
        rr:class roo:additionalTStage; #new roo class
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042; #has_value
        rr:objectMap [
            rr:column "additionalTStage"; 
            rr:datatype xsd:string;
        ];
    ].
    
map:neoplasm rr:predicateObjectMap [
        rr:predicate roo:has_tnm_staging; #new roo predicate                                                          
        rr:objectMap [
            rr:parentTriplesMap map:TNMStaging;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].