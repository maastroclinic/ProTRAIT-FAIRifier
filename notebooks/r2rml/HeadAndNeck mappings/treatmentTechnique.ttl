
########################################## 
# Add treatment Technique
########################################## 
map:treatmentTechniqueQuery a rr:LogicalTable;
    rr:sqlQuery """SELECT 
    GEN_IDNUMBER as id, 
    HN_RT_TREATMENT as treatmentTechnique,
    HN_RT_RT_TECHN_PHO as photonTherapyTreatmentTechnique,
    HN_RT_RT_TECHN_PRO as protonTherapyTreatmentTechnique
        FROM PBDWHackathon2018;""";
    rdfs:label "";
    skos:definition "".

map:treatmentTechnique a rr:TriplesMap;
    rr:logicalTable map:treatmentTechniqueQuery;
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy/treatmentTechnique/{treatmentTechnique}";
        rr:class roo:treatmentTechnique; #new roo classification
    ];
     rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "treatmentTechnique"; 
            rr:datatype xsd:string; 
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100212; #has_property
        rr:objectMap [
            rr:parentTriplesMap map:protonTherapyTreatmentTechnique; 
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100212; #has_property
        rr:objectMap [
            rr:parentTriplesMap map:photonTherapyTreatmentTechnique; 
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].

map:protonTherapyTreatmentTechnique a rr:TriplesMap;
    rr:logicalTable map:treatmentTechniqueQuery;    
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy/treatmentTechnique/protonTherapyTreatmentTechnique/{protonTherapyTreatmentTechnique}";
        rr:class ncit:C66897; #Proton Beam Radiation Therapy
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "protonTherapyTreatmentTechnique"; 
            rr:datatype xsd:string;
        ];
    ].

map:photonTherapyTreatmentTechnique a rr:TriplesMap;
    rr:logicalTable map:treatmentTechniqueQuery;    
    rr:subjectMap [
        rr:template "patient/{id}/cancerTreatment/radiotherapy/treatmentTechnique/photonTherapyTreatmentTechnique/{photonTherapyTreatmentTechnique}";
        rr:class ncit:C104914; #Photon Beam Radiation Therapy
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "protonTherapyTreatmentTechnique"; 
            rr:datatype xsd:string;
        ];
    ].

map:radiotherapy rr:predicateObjectMap [
        rr:predicate roo:has_treatment_technique;
        rr:objectMap [
            rr:parentTriplesMap map:treatmentTechnique; 
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].