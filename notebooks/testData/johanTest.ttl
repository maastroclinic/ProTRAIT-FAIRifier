@prefix rr: <http://www.w3.org/ns/r2rml#>.
@prefix ex: <http://example.com/ns#>.
@prefix map: <http://mapping.local/>.
@prefix sty: <http://purl.bioontology.org/ontology/STY/>.
@prefix sio: <http://semanticscience.org/resource/SIO_>.
@prefix foaf: <http://xmlns.com/foaf/0.1/>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix ncit: <http://ncicb.nci.nih.gov/xml/owl/EVS/Thesaurus.owl#>.
@prefix roo: <http://www.cancerdata.org/roo/>.
@prefix icd: <http://purl.bioontology.org/ontology/ICD10/>.
@prefix skos: <http://www.w3.org/2008/05/skos#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix uo: <http://purl.obolibrary.org/obo/UO_>.
@prefix time: <http://www.w3.org/2006/time#>.


map:patientQuery a rr:LogicalTable;
    rr:sqlQuery """SELECT patient_id AS id,
    treating_clinic, 
    referring_clinic, 
    registration_date
    FROM registration""";
    rdfs:label """
    """;
    skos:definition "id,treating_clinic,referring_clinic,registration_date".

map:patient a rr:TriplesMap;
    rr:logicalTable map:patientQuery;
    rr:subjectMap [
        rr:template "patient/{id}";
        rr:class ncit:C16960;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100061;
        rr:objectMap [
            rr:parentTriplesMap map:identifier;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
         ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100039;
        rr:objectMap [
            rr:parentTriplesMap map:treatingClinic;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100391;
        rr:objectMap [
            rr:parentTriplesMap map:registration;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:referred_by;
        rr:objectMap [
            rr:parentTriplesMap map:referringClinic;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].

map:identifier a rr:TriplesMap;
    rr:logicalTable map:patientQuery;
        rr:subjectMap [
            rr:template "patient/{id}/identifier";
            rr:class ncit:C25364;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042;
        rr:objectMap [
            rr:column "id"; 
            rr:datatype xsd:string;
        ];
    ].

map:treatingClinic a rr:TriplesMap;
    rr:logicalTable map:patientQuery;
        rr:subjectMap [
            rr:template "clinic/{treating_clinic}";
            rr:class ncit:C19326;
    ];
    rr:predicateObjectMap [
        rr:predicate roo:local_value;
        rr:objectMap [
            rr:column "treating_clinic"; 
            rr:datatype xsd:string;
        ];
    ].

map:referringClinic a rr:TriplesMap;
    rr:logicalTable map:patientQuery;
        rr:subjectMap [
            rr:template "clinic/{referring_clinic}";
            rr:class ncit:C19326;
        ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042;
        rr:objectMap [
            rr:column "referring_clinic"; 
            rr:datatype xsd:string;
        ];
    ].

map:registration a rr:TriplesMap;
    rr:logicalTable map:patientQuery;
        rr:subjectMap [
            rr:template "patient/{id}/registration";
            rr:class ncit:C25646;
        ];
    rr:predicateObjectMap [
        rr:predicate roo:P100042;
        rr:objectMap [
            rr:column "registration_date"; 
            rr:datatype xsd:date;
        ];
    ];
    rr:predicateObjectMap [
        rr:predicate roo:at_hospital;
        rr:objectMap [
            rr:parentTriplesMap map:treatingClinic;
            rr:joinCondition [
                rr:child "id";
                rr:parent "id";
            ];
        ];
    ].
